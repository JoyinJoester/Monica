# 银行卡管理功能

## 功能概述

银行卡管理功能已成功集成到应用中，用户可以安全地存储和管理信用卡、借记卡和预付卡信息。

## 主要特性

### 1. 银行卡类型支持
- **借记卡** (Debit Card) - 默认类型
- **信用卡** (Credit Card)
- **预付卡** (Prepaid Card)

每种卡类型使用不同的颜色主题和图标进行视觉区分。

### 2. 完整的卡片信息
- 卡片名称（自定义，例如"工资卡"、"购物卡"等）
- 银行名称
- 卡号（自动脱敏显示）
- 持卡人姓名
- 有效期（月/年）
- CVV/CVC 安全码
- 备注信息
- 收藏功能

### 3. 安全特性

#### 卡号脱敏
- **列表显示**: 只显示最后4位数字
  - 示例: `**** **** **** 3456`
- **编辑时**: 默认隐藏，可点击眼睛图标切换显示

#### CVV保护
- 默认隐藏显示
- 点击眼睛图标可切换可见性
- 限制3-4位数字

#### 数据加密
- 所有敏感信息加密存储在本地数据库
- JSON格式存储完整卡片数据

### 4. 用户界面

#### 底部导航
- 点击"银行卡"标签切换到银行卡列表
- 右下角FAB按钮快速添加新卡

#### 卡片展示
每张卡片显示：
- 自定义卡片名称
- 银行名称（如果已填写）
- 脱敏后的卡号
- 卡类型图标（信用卡/借记卡/预付卡）
- 持卡人姓名
- 有效期（MM/YYYY）
- 收藏星标（如果已收藏）

#### 添加/编辑界面
- 顶部导航栏显示"添加银行卡"或"编辑银行卡"
- 收藏按钮（心形图标）
- 保存按钮（只在卡号不为空时启用）
- 表单字段：
  - 卡片名称
  - 银行名称
  - 卡类型（下拉选择）
  - 卡号（带显示/隐藏切换）
  - 持卡人姓名
  - 有效期（月份 + 年份）
  - CVV/CVC（带显示/隐藏切换）
  - 备注（多行文本）
- 安全提示卡片

### 5. 数据验证

- **卡号**: 只允许数字和空格
- **有效期月份**: 限制2位数字（01-12）
- **有效期年份**: 限制4位数字（例如2025）
- **CVV**: 限制3-4位数字

### 6. 空状态
当没有银行卡时，显示友好的空状态提示：
- 搜索图标
- "还没有银行卡"提示
- "点击右下角的 + 按钮添加"指引

## 技术实现

### 数据模型
```kotlin
data class BankCardData(
    val cardNumber: String,
    val cardholderName: String,
    val expiryMonth: String,
    val expiryYear: String,
    val cvv: String = "",
    val bankName: String = "",
    val cardType: CardType = CardType.DEBIT
)

enum class CardType {
    CREDIT,   // 信用卡
    DEBIT,    // 借记卡
    PREPAID   // 预付卡
}
```

### 数据库
- 使用 `SecureItem` 统一实体存储
- ItemType 设置为 `BANK_CARD`
- 卡片数据以JSON格式存储在 `itemData` 字段

### ViewModel
`BankCardViewModel` 提供：
- `allCards`: Flow<List<SecureItem>> - 所有银行卡
- `getCardById(id)`: 根据ID获取卡片
- `addCard()`: 添加新卡
- `updateCard()`: 更新卡片
- `deleteCard()`: 删除卡片
- `toggleFavorite()`: 切换收藏状态
- `searchCards(query)`: 搜索卡片

### 组件
- `BankCardCard`: 卡片显示组件
- `BankCardListScreen`: 列表屏幕
- `AddEditBankCardScreen`: 添加/编辑屏幕

## 使用指南

### 添加银行卡
1. 点击底部导航的"银行卡"标签
2. 点击右下角的"+"按钮
3. 填写卡片信息（至少需要卡号）
4. 点击顶部的"√"保存

### 编辑银行卡
1. 在列表中点击要编辑的卡片
2. 修改需要更改的信息
3. 点击顶部的"√"保存

### 查看卡号和CVV
- 默认情况下，卡号和CVV是隐藏的
- 在编辑界面点击输入框右侧的眼睛图标切换显示

### 设置收藏
- 在编辑界面点击顶部的心形图标
- 收藏的卡片在列表中会显示红色心形标记

## 安全建议

1. **截屏保护**: 建议在设置中启用截屏保护功能
2. **定期备份**: 虽然数据加密存储，但建议定期备份
3. **密码强度**: 使用强密码保护应用登录
4. **设备安全**: 确保手机本身有锁屏密码

## 后续计划

- [ ] 添加照片功能（拍摄卡片正反面）
- [ ] 搜索功能
- [ ] 按银行分组
- [ ] 导出功能（加密）
- [ ] 生物识别认证

## 已知限制

- 暂不支持照片附件（图片存储功能待实现）
- 搜索功能占位符（待实现）
- 无法批量删除
