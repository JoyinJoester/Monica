# 自动填充功能优化总体方案

**版本**: 1.0  
**日期**: 2025-10-17  
**负责人**: Monica 核心团队

---
## 1. 项目目标与范围

- **目标**: 提升自动填充服务的准确率、响应速度与易用性,实现从识别 → 匹配 → 填充 → 反馈的闭环优化。
- **范围**:
  1. 完善数据匹配算法,支持多语言、多场景。
  2. 优化填充准确率与性能,减少超时/失败情况。
  3. 设计用户友好的交互界面与提示体系。
  4. 制定分阶段实施计划并确保与现有系统无缝集成。

---
## 2. 现状分析与痛点

| 维度             | 现状描述                                               | 存在问题                         |
|------------------|--------------------------------------------------------|----------------------------------|
| 服务启用率       | 需手动到系统设置启用,流程复杂                          | 用户易遗忘,启用率低             |
| 数据匹配算法     | 基于 URL/包名匹配,对多语言、WebView 支持不足           | 匹配失败或展示无关账号           |
| 填充准确率       | 特殊输入框、自定义控件易失败                            | 系统提示 "无法自动填充内容"    |
| 响应时间         | 超过 3 秒可能超时                                      | 系统取消请求,显示失败           |
| 用户反馈         | 失败原因提示不足,缺少日志可视化工具                    | 难以定位问题,用户体验差          |
| 与系统集成       | 与生物识别、手动复制等功能未充分联动                    | 流程断层,用户操作繁琐            |

---
## 3. 优化愿景与关键指标

| 指标                         | 当前水平 | 目标水平 | 评估方式                        |
|------------------------------|----------|----------|----------------------------------|
| 匹配准确率                   | ~75%     | ≥95%     | 自动化用例 + 用户反馈           |
| 填充成功率                   | ~70%     | ≥90%     | 系统日志 + 崩溃统计             |
| 首次响应时间(95 分位)        | 3.2s     | ≤1.5s    | 端侧埋点 + 日志统计             |
| 服务启用率                   | 45%      | ≥80%     | 配置统计 + 用户问卷             |
| 用户满意度(NPS)              | 未量化   | ≥8/10    | 调研问卷 + 应用评分             |

---
## 4. 核心优化策略

### 4.1 数据匹配算法
- **域名匹配增强**: 支持主域、子域、路径、国际化域名、协议自适应。
- **包名/应用识别**: 引入应用签名、应用分类信息,解决同包名多应用冲突。
- **多语言字段映射**: 扩展字段词典,支持 25+ 种语言,包括混合语言与拼音。
- **场景模型引擎**: 构建登录、注册、支付等场景模型,使用机器学习进行字段关系识别。
- **手动标注机制**: 支持用户手动关联字段并持久化,用于训练与回放。

### 4.2 填充准确率提升
- **控件类型识别**: 增强对自定义 View、WebView、React Native、Flutter 等框架的支持。
- **多策略填充**: 普通填充→辅助粘贴→手动选择的降级方案。
- **超时优化**: 填充流程拆分并行执行,增加局部缓存,提升响应速度。
- **回退机制**: 填充失败时提供快速重试、复制用户名/密码、手动选择账号。

### 4.3 用户交互体验
- **启用流程优化**: 引导用户通过应用内一步启用服务,提供启用检测与提醒。
- **悬浮窗/通知栏快捷入口**: 快速切换账号、查看填充记录、复制凭据。
- **错误提示设计**: 直观呈现失败原因,提供“复制密码”“反馈问题”等操作。
- **视觉迭代**: 统一 autofill UI 的主题风格,支持深色模式与动态色彩。

### 4.4 生态集成
- **生物识别联动**: 支持 Face/指纹/主密码/私钥解锁策略,按场景自动选择。
- **WebDAV/云备份联动**: 备份自动填充配置和标注数据,保证跨设备一致性。
- **日志体系建设**: 本地化诊断日志、匿名统计、崩溃捕获。
- **测试与 CI/CD**: 引入自动化测试用例、Monkey 测试、兼容性测试。

---
## 5. 实施路线图与分阶段计划

### 阶段 0: 预研准备 (1 周)
- 梳理现有代码、日志、用户反馈。
- 明确指标与埋点需求,搭建基础测试场景。
- 准备基线用例与性能 profiler。

### 阶段 1: 基础框架升级 (2 周)
- 重构 `MonicaAutofillService` 架构,解耦数据层/策略层/展示层。
- 引入统一日志模块与调试开关。
- 落地埋点,统计匹配源和失败原因。

### 阶段 2: 匹配算法增强 (3 周)
- 实现多语言字段词典与模糊匹配。
- 新增域名解析模块,支持路径/协议/子域。
- 构建场景识别器(规则 + ML 结合),验证准确率。
- 编写自动化测试用例,覆盖主流应用与网站。

### 阶段 3: 填充策略优化 (2 周)
- 支持多策略填充与降级方案。
- 实现自定义控件识别适配器。
- 优化性能:协程拆分、缓存机制、超时控制。
- 集成生物识别多种认证方式。

### 阶段 4: 用户体验迭代 (2 周)
- 完成启用流程优化(检测、提醒、引导)。
- 设计并实现悬浮窗/通知栏快捷操作(可选开关)。
- 改善错误提示界面,提供操作建议。
- 完成 UI 主题统一与动画细节打磨。

### 阶段 5: 系统集成与验证 (2 周)
- 与 WebDAV 备份功能集成,同步配置。
- 引入自动化对比测试,验证准确率/性能提升。
- 完成兼容性测试(主流系统版本、设备)。
- 编写上线文档,制定回滚策略。

### 阶段 6: 上线与反馈 (持续迭代)
- 分批灰度发布,监控关键指标。
- 收集用户反馈与日志,快速修复问题。
- 规划下一轮优化(如机器学习模型上线)。

---
## 6. 任务分解与责任划分

| 模块                     | 主要任务                                             | Owner | 依赖 |
|--------------------------|--------------------------------------------------------|-------|------|
| 架构重构                 | 服务解耦、日志模块、埋点框架                           | A     | -    |
| 匹配算法(策略/数据层)    | 字段词典、域名解析、场景模型、手动标注                | B     | A    |
| 填充策略与性能           | 控件识别、多策略填充、性能优化                         | C     | A,B  |
| 生物识别与安全           | 多因子支持、解锁策略、多端同步                         | D     | C    |
| UI/交互设计              | 启用流程、悬浮窗、错误提示、视觉统一                   | E     | C    |
| 测试与 QA                | 自动化测试、兼容性测试、性能压测                     | QA    | 全员 |

---
## 7. 风险评估与应对策略

| 风险类别        | 描述                                                   | 应对策略                                     |
|-----------------|--------------------------------------------------------|----------------------------------------------|
| 技术风险        | 多语言场景识别准确率不达标                             | 预留规则兜底,引入人工标注回滚机制            |
| 性能风险        | 高频应用场景耗时过长导致超时                           | 分步骤执行、预加载缓存、延迟执行复杂操作     |
| 兼容性风险      | 定制 ROM、第三方输入法导致无法识别字段                 | 建立异常收集库,针对热门机型定制适配          |
| 隐私合规风险    | 日志中泄露隐私字段                                     | 严格脱敏处理、用户可控日志开关               |
| 用户体验风险    | 悬浮窗/通知栏被认为打扰                                 | 提供完全可选开关,默认关闭,明确提醒           |
| 项目进度风险    | 多团队协作导致延迟                                     | 明确阶段目标,每周同步,设置缓冲时间           |

---
## 8. 与现有系统的集成策略

1. **PasswordRepository 集成**: 支持快速查询、字段索引、域名关联。
2. **设置模块联动**: 自动填充设置页与安全设置互通,提供统一入口。
3. **WebDAV 备份**: 新增自动填充配置的备份项,恢复时支持合并策略。
4. **日志 & 诊断**: 与现有日志系统统一格式,支持导出/上传。
5. **安全策略**: 与生物识别、 PIN、主密码统一管理,支持策略组合。
6. **通知体系**: 与现有通知渠道合并,避免重复打扰。

---
## 9. 测试策略与交付标准

### 9.1 自动化测试
- 单元测试: 匹配算法、域名解析、场景模型。
- 仿真测试: 构造常见登录页面快照,执行自动填充。
- UI 测试: 使用 Espresso/Compose Test 模拟用户操作。

### 9.2 手动测试
- 平台覆盖: Android 9 ~ Android 15。
- 场景覆盖: Chrome/Edge/Firefox, 微信/支付宝/银行类应用。
- 特殊场景: 多语言应用、深色模式、WebView、纯原生。

### 9.3 验收标准
- 通过所有自动化测试,无新增崩溃。
- 指标达到目标水平(准确率/成功率/响应时间)。
- 用户体验评审通过,界面一致性达标。
- 安全与隐私审查通过。

---
## 10. 需求跟踪与文档安排

| 文档/产出                 | 负责人 | 完成时间 | 描述                                 |
|---------------------------|--------|----------|--------------------------------------|
| AUTOFILL_ARCHITECTURE.md  | A      | 阶段 1   | 新架构与模块说明                     |
| AUTOFILL_MATCHING_SPEC.md | B      | 阶段 2   | 数据匹配算法设计文档                 |
| AUTOFILL_UI_FLOW.fig      | E      | 阶段 4   | UI 原型与交互流程                    |
| AUTOFILL_TEST_PLAN.md     | QA     | 阶段 5   | 测试场景、用例、标准                 |
| AUTOFILL_RELEASE_NOTES.md | PM     | 上线前   | 发布说明、用户指南、升级提示         |

---
## 11. 沟通机制

- **例会频率**: 每周一次项目例会,汇报阶段进展与风险。
- **日报/周报**: 关键成员每日同步进度,全体每周汇总。
- **问题跟踪**: 使用 GitHub Projects / Jira 建立任务看板。
- **反馈渠道**: 建立专用 Slack/飞书群,实时沟通问题。

---
## 12. 后续展望

- 引入 **联邦学习** 或 **端侧模型**,持续提升字段识别准确率。
- 支持 **跨平台同步**(iOS / Web),构建统一密码生态。
- 探索与 **硬件安全模块** 集成,提升密钥安全等级。
- 建立 **社区贡献机制**,鼓励用户提供场景数据与反馈。

---
## 附录

- **参考资料**: Android Autofill Framework, Jetpack Autofill, PasswordManager API。
- **术语解释**:
  - *Inline Autofill*: Android 11+ 内嵌式建议。
  - *场景模型*: 针对不同页面类型设定的字段匹配模型。
  - *降级方案*: 在主策略失败后,继续提供其他解决路径。

> 本方案将作为自动填充功能中长期优化的执行蓝图,后续版本可在此基础上迭代。
