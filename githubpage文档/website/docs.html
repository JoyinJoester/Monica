<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monica 使用文档</title>
    <!-- Same fonts and generic styles -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Outfit:wght@500;700;800&display=swap"
        rel="stylesheet">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="src/style.css">

    <!-- Markdown Styles -->
    <style>
        .docs-layout {
            display: grid;
            grid-template-columns: 280px 1fr;
            max-width: 1400px;
            margin: 100px auto 40px;
            gap: 40px;
            padding: 0 24px;
        }

        .sidebar {
            position: sticky;
            top: 100px;
            height: calc(100vh - 140px);
            overflow-y: auto;
            border-right: 1px solid var(--sys-light-outline-variant);
            padding-right: 20px;
        }

        .sidebar h3 {
            font-family: var(--font-display);
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .markdown-body {
            font-family: 'Inter', sans-serif;
            line-height: 1.8;
            color: var(--sys-light-on-surface);
            background: var(--sys-light-surface-container-low);
            padding: 40px;
            border-radius: 24px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.02);
            border: 1px solid var(--sys-light-outline-variant);
            min-height: 500px;
        }

        .markdown-body h1,
        .markdown-body h2,
        .markdown-body h3 {
            font-family: var(--font-display);
            margin-top: 1.5em;
            margin-bottom: 0.8em;
            color: var(--sys-light-primary);
        }

        .markdown-body img {
            border-radius: 16px;
            margin: 24px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            max-width: 100%;
            height: auto;
        }

        .markdown-body a {
            color: var(--sys-light-primary);
            text-decoration: underline;
        }

        .markdown-body pre {
            background: #1e1e1e;
            color: #fff;
            padding: 16px;
            border-radius: 12px;
            overflow-x: auto;
            margin: 16px 0;
        }

        .markdown-body code {
            font-family: 'Fira Code', monospace;
            font-size: 0.9em;
        }

        @media (max-width: 900px) {
            .docs-layout {
                grid-template-columns: 1fr;
                margin-top: 80px;
            }

            .sidebar {
                display: none;
            }

            .markdown-body {
                padding: 24px;
                border-radius: 16px;
            }
        }
    </style>
</head>

<body>
    <header>
        <div class="logo">
            <a href="index.html"
                style="display:flex; align-items:center; gap:8px; font-family: var(--font-display); font-weight: 700;">
                <i class='bx bx-arrow-back'></i> <span>返回首页</span>
            </a>
        </div>
        <div style="font-weight: bold; font-family: var(--font-display);">使用文档</div>
    </header>

    <div class="docs-layout">
        <aside class="sidebar" id="toc">
            <!-- Table of Contents injected here -->
            <h3>目录</h3>
            <ul style="list-style: none; padding: 0;" id="toc-list"></ul>
        </aside>

        <main class="markdown-body" id="content">
            <div style="text-align: center; padding: 80px;">
                <i class='bx bx-loader-alt bx-spin' style="font-size: 3rem; color: var(--sys-light-primary);"></i>
                <p style="margin-top: 16px; color: var(--sys-light-secondary);">正在加载文档...</p>
            </div>
        </main>
    </div>

    <!-- Lightbox reuse -->
    <div class="lightbox" id="lightbox">
        <img src="" alt="Full View" class="lightbox-img" id="lightbox-img">
    </div>

    <!-- Mark Library via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script type="module">
        import { initLightbox } from './src/main.js';

        // 1. Fetch Markdown
        async function loadDocs() {
            try {
                // Use relative path to handle sub-directory hosting
                const response = await fetch('docs/usage.md');
                if (!response.ok) throw new Error('Failed to load docs');
                const text = await response.text();

                // 2. Render
                const contentDiv = document.getElementById('content');
                // Configure marked for safer rendering or specific options if needed
                contentDiv.innerHTML = marked.parse(text);

                // 3. Fix Image Paths in rendered HTML
                // The markdown might have 'image/foo.jpg', we need 'images/foo.jpg'
                const images = contentDiv.querySelectorAll('img');
                images.forEach(img => {
                    const src = img.getAttribute('src');
                    if (src && src.startsWith('image/')) {
                        img.src = src.replace('image/', 'images/');
                    }
                });

                // 4. Generate TOC
                generateTOC();

                // 5. Init Lightbox for new images
                initLightbox();
            } catch (e) {
                document.getElementById('content').innerHTML = `
                    <div style="text-align:center; padding: 40px;">
                        <i class='bx bx-error-circle' style="font-size: 3rem; color: #ff5252;"></i>
                        <p style="color:#ff5252; margin-top:16px;">加载失败: ${e.message}</p>
                        <p style="font-size: 0.9rem; color: var(--sys-light-secondary);">请检查网络连接或刷新页面重试。</p>
                    </div>
                `;
            }
        }

        function generateTOC() {
            const tocList = document.getElementById('toc-list');
            const headers = document.querySelectorAll('.markdown-body h2, .markdown-body h3');

            if (headers.length === 0) {
                const li = document.createElement('li');
                li.textContent = '暂无目录';
                li.style.color = 'var(--sys-light-outline)';
                tocList.appendChild(li);
                return;
            }

            headers.forEach((header, index) => {
                header.id = `section-${index}`;
                const li = document.createElement('li');
                li.style.marginBottom = '12px';
                li.style.paddingLeft = header.tagName === 'H3' ? '16px' : '0px';

                const a = document.createElement('a');
                a.href = `#section-${index}`;
                a.textContent = header.textContent;
                a.style.textDecoration = 'none';
                a.style.color = 'var(--sys-light-secondary)';
                a.style.fontSize = '0.95rem';
                a.style.transition = 'color 0.2s';

                a.onmouseover = () => a.style.color = 'var(--sys-light-primary)';
                a.onmouseout = () => a.style.color = 'var(--sys-light-secondary)';

                a.onclick = (e) => {
                    e.preventDefault();
                    const top = header.getBoundingClientRect().top + window.pageYOffset - 120;
                    window.scrollTo({ top, behavior: 'smooth' });
                };

                li.appendChild(a);
                tocList.appendChild(li);
            });
        }

        loadDocs();
    </script>
</body>

</html>