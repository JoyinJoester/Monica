# Monica 自动填充功能测试指南

## 快速开始

### 方法 1：使用构建脚本（推荐）

1. 打开命令提示符，进入 `test-app` 目录
2. 运行构建脚本：
   ```bash
   build-and-install.bat
   ```
3. 等待编译和安装完成

### 方法 2：使用 Android Studio

1. 用 Android Studio 打开 `test-app` 文件夹
2. 等待 Gradle 同步完成
3. 连接 Android 设备或启动模拟器
4. 点击 Run 按钮（绿色三角形）

### 方法 3：手动编译

```bash
cd test-app
gradlew assembleDebug
adb install build/outputs/apk/debug/test-app-debug.apk
```

## 测试前准备

### 1. 在 Monica 中添加测试密码

打开 Monica 应用，添加一个新的密码条目：

- **标题**: 测试账号
- **用户名**: testuser
- **密码**: Test123456
- **应用包名**: `com.test.autofilltest`（重要！）

你可以添加多个密码条目来测试多密码匹配场景。

### 2. 启用 Monica 自动填充服务

#### 标准 Android 设备：
1. 打开系统设置
2. 搜索"自动填充"
3. 选择 Monica 作为自动填充服务

#### 小米 MIUI：
1. 设置 → 更多设置 → 语言和输入法 → 自动填充服务
2. 选择 Monica
3. 安全中心 → 应用管理 → Monica → 权限管理 → 允许自动填充

#### 华为 EMUI/HarmonyOS：
1. 设置 → 系统和更新 → 语言和输入法 → 自动填充服务
2. 选择 Monica

#### OPPO ColorOS：
1. 设置 → 其他设置 → 键盘与输入法 → 自动填充服务
2. 选择 Monica

#### Vivo OriginOS：
1. 设置 → 更多设置 → 输入法 → 自动填充服务
2. 选择 Monica

## 测试步骤

### 基础功能测试

1. **打开测试应用**
   - 在应用列表中找到"自动填充测试"
   - 点击打开

2. **触发自动填充**
   - 点击"用户名"输入框
   - 观察是否出现自动填充建议

3. **预期结果**：
   - ✅ Android 11+：键盘上方显示内联建议
   - ✅ Android 8-10：输入框下方显示下拉菜单
   - ✅ 显示 Monica 图标和密码标题

4. **选择密码**
   - 点击自动填充建议
   - 观察表单是否自动填充

5. **验证填充**
   - 检查用户名是否正确填充
   - 检查密码是否正确填充
   - 点击"登录"按钮
   - 应该显示"登录成功"

### 高级测试场景

#### 场景 1：多密码匹配
1. 在 Monica 中为 `com.test.autofilltest` 添加 3 个不同的密码
2. 打开测试应用，点击输入框
3. 应该看到所有匹配的密码选项
4. 选择任意一个，验证填充正确

#### 场景 2：密码框触发
1. 清除表单（点击"清除"按钮）
2. 直接点击"密码"输入框（跳过用户名）
3. 应该仍然能看到自动填充建议
4. 选择后应该同时填充用户名和密码

#### 场景 3：横屏模式
1. 旋转设备到横屏
2. 测试自动填充是否正常工作
3. 检查 UI 是否正常显示

#### 场景 4：应用切换
1. 填充密码后，切换到其他应用
2. 返回测试应用
3. 检查填充的内容是否保留

## 故障排查

### 问题 1：没有显示自动填充建议

**可能原因**：
- Monica 服务未启用
- 没有匹配的密码条目
- 包名不匹配

**解决方法**：
1. 打开 Monica → 设置 → 自动填充
2. 检查服务状态（应该显示"已启用"）
3. 点击"故障排查"查看详细信息
4. 确认密码条目的包名是 `com.test.autofilltest`

### 问题 2：显示建议但点击无反应

**可能原因**：
- 密码数据不完整
- 字段解析失败

**解决方法**：
1. 检查密码条目是否包含用户名和密码
2. 查看 Monica 诊断日志
3. 尝试重启 Monica 应用

### 问题 3：只填充了密码，没有填充用户名

**可能原因**：
- 密码条目缺少用户名字段

**解决方法**：
1. 编辑密码条目，确保填写了用户名
2. 重新测试

### 问题 4：特定设备不工作

**可能原因**：
- ROM 限制或兼容性问题

**解决方法**：
1. 查看 Monica 的设备特定设置指南
2. 检查是否需要额外的权限
3. 尝试在开发者选项中禁用"自动填充优化"

## 查看诊断信息

1. 打开 Monica 应用
2. 进入：设置 → 自动填充
3. 点击"故障排查"按钮
4. 查看：
   - 设备信息
   - 服务状态
   - 最近的请求
   - 检测到的问题
   - 解决建议

5. 点击"导出日志"保存详细日志

## 测试检查清单

- [ ] Monica 服务已启用
- [ ] 已添加测试密码条目（包名正确）
- [ ] 点击用户名框显示建议
- [ ] 点击密码框显示建议
- [ ] 选择密码后正确填充
- [ ] 多个密码都能正确显示和选择
- [ ] 横屏模式正常工作
- [ ] 内联建议显示正常（Android 11+）
- [ ] 下拉菜单显示正常（Android 8-10）

## 性能测试

记录以下指标：
- 点击输入框到显示建议的时间：______ ms
- 选择密码到填充完成的时间：______ ms
- 是否有卡顿或延迟：是 / 否

## 报告问题

如果发现问题，请记录：
1. 设备型号和 Android 版本
2. 具体的操作步骤
3. 预期结果 vs 实际结果
4. 诊断日志（从 Monica 导出）
5. 截图或录屏

将这些信息提供给开发团队以便修复。
